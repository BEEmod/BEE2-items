"Replacements"
	{
	"%NODRAW%" "1"
	"%CC_CND%" "World.RobotNegInteractPitchedUp"
	"%TEMP%" "REX_PELLET_FIELD_TEMP"
	}

"Fizzlers"
	{
	// We have two type of this, and therefore two fizzler types. We just swap to timer
	// if needed.
	"Fizzler"
		{
		"ID"            "BEE2_REX_PELLET_FIELD_TOGGLE"
		"Item_ID"       "ITEM_REX_PELLET_FIELD"
		
		"Base_Inst"     "<ITEM_REX_PELLET_FIELD:bee2_toggle_base>"
		"Model_Left"    "<ITEM_REX_PELLET_FIELD:bee2_toggle_model>"
		"Model_Right"   "<ITEM_REX_PELLET_FIELD:bee2_toggle_model>"
		"Nodraw_behind" "%NODRAW%"
		
		"TemplateBrush"	
			{
			"Left"      "%TEMP%:toggle_side"
			"Right"     "%TEMP%:toggle_side"
			// Shrink the length so the curve fits in the space..
			"Single"    "%TEMP%:toggle_single"
			
			"Keys"
				{
				"classname"  "func_brush"
				"solidity"   "1"  // Never solid
				"spawnflags" "1" // No +use output
				}
			"LocalKeys"
				{
				"targetname" "field"
				}
			}
	
		"Brush"
			{
			"Name"          "fizz"
			
		    "tex_trigger"   "tools/toolstrigger"
			"Singular" "1"
		    
			"Keys"
				{
				"classname"     "trigger_multiple"
				"Spawnflags"    "64" // Everything
				"filtername"    "$filter"
				"vscripts"      "BEE2/rex_pellet_field.nut"
				}
			"Outputs"
				{
				"OnStartTouch"  "out,ToggleTest,,0,-1"
				}
			"set_axis_var" "1" // Save the plane axis to the "axis" vscript variable.
			}
		}
	"Fizzler"
		{
		"ID"        "BEE2_REX_PELLET_FIELD_TIMER"
		
		"Base_Inst" "<ITEM_REX_PELLET_FIELD:bee2_timer_base>"
		"Model_Left"    "<ITEM_REX_PELLET_FIELD:bee2_timer_model>"
		"Model_Right"   "<ITEM_REX_PELLET_FIELD:bee2_timer_model>"
		
		"TemplateBrush"
			{		
			"Left"  "%TEMP%:timer_side"
			"Right" "%TEMP%:timer_side"
			// Shrink the length so the curve fits in the space..
			"Single"    "%TEMP%:timer_single"
			"Keys"
				{
				"classname"  "func_brush"
				"solidity"   "1"  // Never solid
				"spawnflags" "1" // No +use output
				}
			// No name, doesn't change
			}
	
		"Brush"
			{
			"Name"          "fizz"
			
		    "tex_trigger"   "tools/toolstrigger"
			"Singular" "1"
		    
			"Keys"
				{
				"classname"     "trigger_multiple"
				"Spawnflags"    "64" // Everything
				"filtername"    "$filter"
				"vscripts"      "BEE2/rex_pellet_field.nut"
				}
			"Outputs"
				{
				"OnStartTouch"  "out,FireUser4,,0,-1"
				}
			"set_axis_var" "1" // Save the plane axis to the "axis" vscript variable.
			}
		}
	}

"Conditions"
	{
	"Condition"  
		{
		"instance"  "<ITEM_REX_PELLET_FIELD:fizz_base>"  
		"Condition"
			{
			"instvar" "timer_delay > 0"
			"instvar" "timer_delay <= 30"
				
			"Result"
				{
				"ChangeFizzlerType" "BEE2_REX_PELLET_FIELD_TIMER"
				"TimedRelay"
					{
					"variable"      "$timer_delay"
					"targetname"    "delay_rl"
					"RepOutputs"
						{
						"OnTrigger" "out,PlaySound,,0,-1"
						"OnTrigger" "@command,Command,cc_emit Portal.room1_TickTock,0,-1"
						}
					"FinalOutputs"
						{
						"OnTrigger" "repeat_branch,SetValue,0,0,-1"
						"OnTrigger" "out,FireUser1,,0,-1"
						}
					}
				}
			}
		"Result"
			{
			"Has"
				{
				"Fizzler"           "1"
				"RexPelletField"    "1"
				}
			"addGlobal" "instances/bee2/logic/rex_pellet_field.vmf"
			"GlobalInput"
				{
				// If the material_modify_control isn't set on startup,
				// it doesn't apply. So set it on spawn - a time of zero
				// applies it immediately.
				"input"  "StartFloatLerp"
				"Param" "1 0 0 0"
				"target" "mod"
				}
			}
		}
	"Condition"
		{
		"Priority" "50"
		"instance" "<ITEM_REX_PELLET_FIELD>"
		"Condition"
			{
			"Has" "Pellet"
			"Has" "RocketTurret"
			"Result"
				{
				// OR both filters.
				"addGlobal" "instances/bee2/logic/filter_flux_field.vmf"
				"SetInstVar" "$filter @filter_flux_field"
				}
			"ElseCondition"
				{
				"Has" "RocketTurret"
				"Result"
					{
					"SetInstVar" "$filter @rocket_filter"
					}
				"Else"
					{
					// In global_pti_ents, if not present, 
					// it'll just always fail.
					"SetInstVar" "$filter @filter_pellet"
					}
				}
			}
		}
	}
