"Conditions"
	{
	"Condition"
		{
		"instance" "<ITEM_PANEL_CLEAR>"
		"Result"
			{
			"Has" "Glass"
			}
		"Condition"
			{
			"Orientation" "floor"
			"Result"
				{
				// If on the floor, add a grating so there's somewhere 
				// for the player to stand.
				"AddOverlay" "instances/BEE2/clean/static_panel/floor_grate.vmf"
				}
			}
		"Result"
			{
			"MapInstVar"
				{
				"$animation" "$angle"
				"ramp_30_deg_open" "30"
				"ramp_45_deg_open" "45"
				"ramp_60_deg_open" "60"
				"ramp_90_deg_open" "90"
				}
			}
		"Condition"
			{
			"instvar" "$connectioncount > 0"
			// Dynamic
			"Result"
				{
				"GlobalInput"
					{
					"Target" "model_arms"
					"Input"  "SetAnimation"
					"Param"  "$animation"
					"Delay"  "0.0"
					}
				"Condition"
					{
					"instvar" "$start_deployed 0"
					"Result"
						{
						"GlobalInput"
							{
							"Target" "model_arms"
							"Input"  "SetPlaybackRate"
							"Param"  "-1"
							"Delay"  "0.01"
							}
						}
					}
				"TemplateBrush" "BEE2_ANGLED_PAN_CLEAN_COLL:dynamic_$angle"
				// Fortunately these two clip situations are mutually exclusive.
				"Condition"
					{
					"InstVar" "$angle <= 45"
					"Orientation"
						{
						"from_dir" "1 0 0"
						"direction" "0 0 1"
						}
					"Result"
						{
						"TemplateBrush"
							{
							"ID" "BEE2_ANGLED_PAN_CLEAN_INV_CLIP:dynamic_$angle"
							"Keys"
								{
								"classname" "func_brush"
								"parent_attachment_point" "panel_attach"
								}
							"LocalKeys"
								{
								"parentname" "model_arms"
								}
							}
						}
					}
				"Condition"	
					{
					"InstVar" "$angle >= 60"
					"Orientation"
						{
						"from_dir" "0 1 0"
						"direction" "0 0 1"
						"allow_inverse" "1"
						}
					"Result"
						{
						"TemplateBrush"
							{
							"ID" "BEE2_ANGLED_PAN_CLEAN_SIDE_CLIP:dynamic_$angle"
							"Keys"
								{
								"classname" "func_brush"
								"parent_attachment_point" "panel_attach"
								}
							"LocalKeys"
								{
								"parentname" "model_arms"
								}
							}
						}
					}
				}
			"ElseCondition" // Otherwise, static.
				{
				"InstVar" "$start_deployed = 0"
				"Result"
					{
					// Flat on the floor.
					"ChangeInstance" "instances/BEE2/clean/static_panel/00_glass.vmf"
					}
				// If facing sideways, you can also get stuck if you drop
				// between the arms.
				"ElseCondition"
					{
					"InstVar" "$angle >= 60"
					"Orientation"
						{
						"from_dir" "0 1 0"
						"direction" "0 0 1"
						"allow_inverse" "1"
						}
					"Result"
						{
						"TemplateBrush" "BEE2_ANGLED_PAN_CLEAN_SIDE_CLIP:static_$angle"
						}
					}
				"ElseSwitch"
					{
					"Flag" "instvar"
					"$animation ramp_30_deg_open"
						{
						"TemplateBrush" "BEE2_ANGLED_PAN_CLEAN_COLL:static_30"
						"ChangeInstance" "instances/BEE2/clean/static_panel/30_glass.vmf"
						// If facing with the panel down, it's possible you can
						// get stuck "sliding" between the embed wall and the
						// panel backface. This adds clips to prevent that.
						"Condition"
							{
							"Orientation"
								{
								"from_dir" "1 0 0"
								"direction" "0 0 1"
								}
							"Result"
								{
								"TemplateBrush" "BEE2_ANGLED_PAN_CLEAN_INV_CLIP:static_30"
								}
							}
						}
					"$animation ramp_45_deg_open"
						{
						"TemplateBrush" "BEE2_ANGLED_PAN_CLEAN_COLL:static_45"
						"ChangeInstance" "instances/BEE2/clean/static_panel/45_glass.vmf"
						// Same as 30 degrees.
						"Condition"
							{
							"Orientation"
								{
								"from_dir" "1 0 0"
								"direction" "0 0 1"
								}
							"Result"
								{
								"TemplateBrush" "BEE2_ANGLED_PAN_CLEAN_INV_CLIP:static_45"
								}
							}
						}
					"$animation ramp_60_deg_open"
						{
						"TemplateBrush" "BEE2_ANGLED_PAN_CLEAN_COLL:static_60"
						"ChangeInstance" "instances/BEE2/clean/static_panel/60_glass.vmf"
						}
					"$animation ramp_90_deg_open"
						{
						"TemplateBrush" "BEE2_ANGLED_PAN_CLEAN_COLL:static_90"
						"ChangeInstance" "instances/BEE2/clean/static_panel/90_glass.vmf"
						}
					}
				}
			}
		}
	}	
