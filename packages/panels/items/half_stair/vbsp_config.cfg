"Replacements"
	{
	"%PACKFILE%"    "BEE2_PANEL_HALF_STAIR_CLEAN"
	
	"%UPPER_TEMP%"  "BEE2_PANEL_HALF_STAIR_TOP_CLEAN:stair_upper"
	"%LOWER_TEMP%"  "BEE2_PANEL_HALF_STAIR_TOP_CLEAN:stair_lower"
	"%STATIC_TEMP%" "BEE2_PANEL_HALF_STAIR_STATIC"
	
	"%EDGE_ORIG_TEX%"   "metal/black_wall_metal_002d"
	"%EDGE_PORTAL_TEX%" "BEE2/clean/stair_edge_portal"

	// Only useful for Overgrown...
	"%TILE_CHANCE%" "0"
	"%FORCE_VAR%"   ""
	}

"Conditions"
	{
	"Condition"
		{
		"instance" "<ITEM_BEE2_PANEL_HALF_STAIR>"
		"Condition"
			{
			"instvar"	"connectioncount 0"
			"OR"
				{
				"ItemConfig"
					{
					"ID"    "VALVE_TEST_ELEM"
					"Name"  "AllowBrushStair"
					"Value" "1"
					}
				// Force this static route to be taken if brush stairs are disallowed.
				"instvar"	"$start_deployed 0"
				}
			"Result"
				{
				"SetInstVar" "$is_dyn 0"
				}
			"Else"
				{
				"SetInstVar" "$is_dyn 1"
				}
			}
		"Condition" // Low
			{
			"instance" "<ITEM_BEE2_PANEL_HALF_STAIR:btn_weighted>"
			"Condition"
				{
				"instvar" "$is_dyn"
				"Result"
					{
					"TemplateBrush"
						{
						"ID" "BEE2_PANEL_HALF_STAIR_TOP_CASE:case_lower"
						"colorVar"  "<editor>"
						}
					"ChangeInstance" "<ITEM_BEE2_PANEL_HALF_STAIR:bee2_dynamic>"
					}
				"Else"
					{
					"Condition"
						{
						"instvar" "$start_reversed 1"
						"Result"
							{
							"TemplateBrush"
								{
								"ID"    "%STATIC_TEMP%:white_lower"
								}
							}
						"Else"
							{
							"TemplateBrush"
								{
								"ID"    "%STATIC_TEMP%:black_lower"
								}
							}
						}
					"ChangeInstance" "<ITEM_BEE2_PANEL_HALF_STAIR:bee2_static>"
					}
				}
			}
		"Condition" // Mid
			{
			"instance" "<ITEM_BEE2_PANEL_HALF_STAIR:btn_cube>"
			"Condition"
				{
				"instvar" "$is_dyn"
				"Result"
					{
					"TemplateBrush"
						{
						"ID" "BEE2_PANEL_HALF_STAIR_TOP_CASE:case_mid"
						"colorVar"  "<editor>"
						}
					"OffsetInstance" "0 0 32"
					"ChangeInstance" "<ITEM_BEE2_PANEL_HALF_STAIR:bee2_dynamic>"
					}
				"Else"
					{
					"Condition"
						{
						"instvar" "$start_reversed 1"
						"Result"
							{
							"TemplateBrush"
								{
								"ID"    "%STATIC_TEMP%:white_mid"
								}
							}
						"Else"
							{
							"TemplateBrush"
								{
								"ID"    "%STATIC_TEMP%:black_mid"
								}
							}
						}
					"OffsetInstance" "0 0 32"
					"ChangeInstance" "<ITEM_BEE2_PANEL_HALF_STAIR:bee2_static>"
					}
				}
			}
		"Condition" // High
			{
			"instance" "<ITEM_BEE2_PANEL_HALF_STAIR:btn_ball>"
			"Condition"
				{
				"instvar" "$is_dyn"
				"Result"
					{
					"TemplateBrush"
						{
						"ID" "BEE2_PANEL_HALF_STAIR_TOP_CASE:case_upper"
						"colorVar"  "<editor>"
						}
					"OffsetInstance" "0 0 64"
					"ChangeInstance" "<ITEM_BEE2_PANEL_HALF_STAIR:bee2_dynamic>"
					}
				"Else"
					{
					"Condition"
						{
						"instvar" "$start_reversed 1"
						"Result"
							{
							"TemplateBrush"
								{
								"ID"    "%STATIC_TEMP%:white_upper"
								}
							}
						"Else"
							{
							"TemplateBrush"
								{
								"ID"    "%STATIC_TEMP%:black_upper"
								}
							}
						}
					"OffsetInstance" "0 0 64"
					"ChangeInstance" "<ITEM_BEE2_PANEL_HALF_STAIR:bee2_static>"
					}
				}
			}
		}
	"Condition"
		{
		"instance" "<ITEM_BEE2_PANEL_HALF_STAIR:bee2_dynamic>"
		// Force the edge to be portalable for white panels,
		// otherwise you end up unable to portal often.
		"Condition"
			{
			"instvar" "$start_reversed 1"
			"Result"
				{
				"SetInstVar" "$edge_tex %EDGE_PORTAL_TEX%"
				}
			"Else"
				{
				"SetInstVar" "$edge_tex %EDGE_ORIG_TEX%"
				}
			}
		"Result"
			{
			"Pack" "%PACKFILE%"
			// Visgroup configs are for Overgrown style, they have no affect here.
			"TemplateBrush"
				{
				"ID"          "%LOWER_TEMP%"
				"invertVar"   "$start_reversed"
				"visgroup"    "%TILE_CHANCE%"
				"forceVisVar" "%FORCE_VAR%"
				"Replace"
					{
					"%EDGE_ORIG_TEX%" "$edge_tex"
					}
				"keys"
					{
					"classname"     "func_brush"
					"origin"        "-32 0 -65"
					"spawnflags"    "2" // Ignore player +USE
					}
				"localkeys"
					{
					"targetname"    "brush_step_1"
					"parentname"    "mdl,panel_attach_lower"
					}
				}
			"TemplateBrush"
				{
				"ID"          "%UPPER_TEMP%"
				"invertVar"   "$start_reversed"
				"visgroup"    "%TILE_CHANCE%"
				"forceVisVar" "%FORCE_VAR%"
				"Replace"
					{
					"%EDGE_ORIG_TEX%" "$edge_tex"
					}
				"keys"
					{
					"classname"     "func_brush"
					"origin"        "32 0 -65"
					"spawnflags"    "2"
					}
				"localkeys"
					{
					"targetname"    "brush_step_2"
					"parentname"    "mdl,panel_attach_upper"
					}
				}
			}
		}
	}

